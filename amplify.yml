version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        - echo "=== Debugging Amplify Environment ==="
        - echo "Checking all environment variables..."
        - printenv | wc -l
        - echo "Looking for any SUPABASE vars..."
        - printenv | grep -i supabase || echo "No supabase vars found in printenv"
        - echo "Looking for any AWS_* vars..."
        - printenv | grep -E "^AWS_" | head -5 || echo "No AWS vars"
        - echo "Checking if .env files exist..."
        - ls -la .env* 2>/dev/null || echo "No .env files found"
        - echo "Checking Amplify-specific locations..."
        - cat /codebuild/output/tmp/env.sh 2>/dev/null || echo "No Amplify env.sh found"
        - ls -la /codebuild/ 2>/dev/null || echo "No /codebuild directory"
    build:
      commands:
        - echo "=== Final Environment Check Before Build ==="
        - echo "NEXT_PUBLIC_SUPABASE_URL length = $(echo -n \"$NEXT_PUBLIC_SUPABASE_URL\" | wc -c)"
        - echo "NEXT_PUBLIC_SUPABASE_ANON_KEY length = $(echo -n \"$NEXT_PUBLIC_SUPABASE_ANON_KEY\" | wc -c)"
        - echo "=== Starting Next.js Build ==="
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
